<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Destruye y Ordena - Juego</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
    text-align: center;
  }

  header {
    background: #222;
    padding: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .coins {
    font-size: 18px;
  }

  button {
    padding: 8px 12px;
    cursor: pointer;
    font-size: 14px;
  }

  .palette-shop {
    margin: 20px;
  }

  .palette {
    display: inline-block;
    width: 120px;
    padding: 10px;
    margin: 10px;
    border: 1px solid white;
    cursor: pointer;
  }

  .palette.locked {
    opacity: 0.4;
  }

  .game-area {
    margin-top: 30px;
    padding: 20px;
    border-top: 1px solid #444;
  }
</style>
</head>

<body>

<header>
  <div class="coins">ðŸª™ Monedas: <span id="coins">0</span></div>
  <button onclick="logout()">Salir</button>
</header>

<h1>ðŸŽ® Destruye y Ordena</h1>

<section class="palette-shop">
  <h2>ðŸŽ¨ Paletas de Colores</h2>
  <div id="palettes"></div>
</section>

<section class="game-area">
  <h2>Zona de Juego</h2>
  <p>Paleta activa: <span id="activePalette">Default</span></p>
  <button onclick="earnCoins()">Ganar monedas</button>
</section>

<script>
/* ðŸ”‘ CONFIGURA SUPABASE */
const supabaseUrl = "https://TU_PROYECTO.supabase.co";
const supabaseKey = "TU_PUBLIC_ANON_KEY";
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

/* PALETAS DISPONIBLES */
const paletteList = [
  { id: 1, name: "ClÃ¡sica", price: 0, colors: ["#fff", "#888"] },
  { id: 2, name: "NeÃ³n", price: 50, colors: ["#0ff", "#f0f"] },
  { id: 3, name: "Fuego", price: 100, colors: ["#f00", "#ff0"] }
];

let user;
let userCoins = 0;
let ownedPalettes = [];
let activePalette = "ClÃ¡sica";

/* VERIFICAR SESIÃ“N */
async function checkSession() {
  const { data } = await supabase.auth.getUser();
  if (!data.user) {
    window.location.href = "index.html";
  }
  user = data.user;
  loadUserData();
}

/* CARGAR DATOS DEL USUARIO */
async function loadUserData() {
  const { data: profile } = await supabase
    .from("usuarios")
    .select("monedas")
    .eq("id", user.id)
    .single();

  userCoins = profile.monedas;
  document.getElementById("coins").textContent = userCoins;

  const { data: purchases } = await supabase
    .from("compras_paletas")
    .select("palette_id")
    .eq("user_id", user.id);

  ownedPalettes = purchases.map(p => p.palette_id);
  renderPalettes();
}

/* MOSTRAR PALETAS */
function renderPalettes() {
  const container = document.getElementById("palettes");
  container.innerHTML = "";

  paletteList.forEach(p => {
    const owned = p.price === 0 || ownedPalettes.includes(p.id);

    const div = document.createElement("div");
    div.className = "palette" + (owned ? "" : " locked");
    div.innerHTML = `
      <strong>${p.name}</strong><br>
      Precio: ${p.price} ðŸª™
    `;

    div.onclick = () => {
      if (owned) {
        activatePalette(p.name);
      } else {
        buyPalette(p);
      }
    };

    container.appendChild(div);
  });
}

/* COMPRAR PALETA */
async function buyPalette(palette) {
  if (userCoins < palette.price) {
    alert("No tienes suficientes monedas");
    return;
  }

  await supabase.from("compras_paletas").insert({
    user_id: user.id,
    palette_id: palette.id
  });

  userCoins -= palette.price;

  await supabase
    .from("usuarios")
    .update({ monedas: userCoins })
    .eq("id", user.id);

  document.getElementById("coins").textContent = userCoins;
  ownedPalettes.push(palette.id);
  renderPalettes();
}

/* ACTIVAR PALETA */
function activatePalette(name) {
  activePalette = name;
  document.getElementById("activePalette").textContent = name;
}

/* GANAR MONEDAS (EJEMPLO DE JUEGO) */
async function earnCoins() {
  userCoins += 10;

  await supabase
    .from("usuarios")
    .update({ monedas: userCoins })
    .eq("id", user.id);

  document.getElementById("coins").textContent = userCoins;
}

/* LOGOUT */
async function logout() {
  await supabase.auth.signOut();
  window.location.href = "index.html";
}

checkSession();
</script>

</body>
</html>
